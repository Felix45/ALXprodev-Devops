#!/bin/bash

input_dir="pokemon_data"
output_csv="pokemon_report.csv"

# Header for the CSV
echo "Name,Height (m),Weight (kg)" > "$output_csv"

# Temporary file to hold just numeric values for awk processing
temp_data="temp_numeric_data.txt"
> "$temp_data"  # Clear the file

# Loop over all JSON files
for file in "$input_dir"/*.json; do
    name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
    height_dm=$(jq -r '.height' "$file")
    weight_hg=$(jq -r '.weight' "$file")

    # Convert height (decimetres to metres) and weight (hectograms to kilograms)
    height_m=$(awk "BEGIN { printf \"%.1f\", $height_dm / 10 }")
    weight_kg=$(awk "BEGIN { printf \"%.1f\", $weight_hg / 10 }")

    echo "$name,$height_m,$weight_kg" >> "$output_csv"
    echo "$height_m $weight_kg" >> "$temp_data"
done

# Use awk to calculate averages
read avg_height avg_weight <<< $(awk '
{
    total_height += $1;
    total_weight += $2;
    count++;
}
END {
    printf "%.2f %.2f", total_height / count, total_weight / count;
}' "$temp_data")

# Display output
echo "CSV Report generated at: $output_csv"
echo
cat "$output_csv"
echo
echo "Average Height: $avg_height m"
echo "Average Weight: $avg_weight kg"

# Cleanup
rm -f "$temp_data"
